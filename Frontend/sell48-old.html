<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Sell in 48 Hours ‚Äì Guaranteed | Cars And Bikes In India-CABII</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family: Arial, sans-serif;
  background:#f4f6f8;
}
.header{
  background:#0b3c91;
  color:#fff;
  padding:15px 20px;
  font-size:20px;
  font-weight:bold;
}
.container{
  max-width:950px;
  margin:30px auto;
  background:#fff;
  padding:25px;
  border-radius:10px;
  box-shadow:0 10px 30px rgba(0,0,0,0.15);
}
h2{color:#0b3c91;margin-bottom:5px}
.sub{color:#555;margin-bottom:20px}

.form-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:15px;
}

label{font-size:14px;font-weight:600}
input,select,textarea{
  width:100%;
  padding:10px;
  margin-top:5px;
  border-radius:6px;
  border:1px solid #ccc;
  font-size:14px;
}

textarea{resize:vertical}

.guarantee-box{
  margin:20px 0;
  padding:15px;
  background:#e8f4ff;
  border-left:5px solid #0b3c91;
  font-size:14px;
}

.price-box{
  display:none;
  background:#f0fdf4;
  border:1px solid #16a34a;
  padding:15px;
  border-radius:8px;
  margin-top:15px;
}
.price-box span{font-weight:bold}

button{
  background:#16a34a;
  color:#fff;
  padding:14px 22px;
  font-size:16px;
  border:none;
  border-radius:8px;
  cursor:pointer;
}
button.secondary{
  background:#0b3c91;
  margin-right:10px;
}
button:disabled{background:#9ca3af}

#message{margin-top:15px;font-weight:bold}
.success{color:#16a34a}
.error{color:#dc2626}
</style>
</head>

<body>

<div class="header">
üöÄ Sell in 48 Hours ‚Äì Guaranteed | Cars And Bikes In India ‚Äì CABII
</div>

<div class="container">

<h2>Vehicle Details</h2>
<p class="sub">Market based smart pricing will be calculated automatically.</p>

<form id="sell48Form">

<div class="form-grid">

<div>
<label>Vehicle Type</label>
<select name="vehicleType" required>
<option value="">Select</option>
<option value="Car">Car</option>
<option value="Bike">Bike</option>
</select>
</div>

<div>
<label>Brand</label>
<input type="text" name="brand" required>
</div>

<div>
<label>Model</label>
<input type="text" name="model" required>
</div>

<div>
<label>Manufacturing Year</label>
<input type="number" name="year" min="1995" max="2026" required>
</div>

<div>
<label>KM Driven</label>
<input type="number" name="km" required>
</div>

<div>
<label>Fuel</label>
<select name="fuel" required>
<option value="Petrol">Petrol</option>
<option value="Diesel">Diesel</option>
<option value="CNG">CNG</option>
<option value="Electric">Electric</option>
</select>
</div>

<div>
<label>Transmission</label>
<select name="transmission" required>
<option value="Manual">Manual</option>
<option value="Automatic">Automatic</option>
</select>
</div>

<div>
<label>City</label>
<input type="text" name="city" required>
</div>

<div>
<label>Your Expected Price (‚Çπ)</label>
<input type="number" name="expectedPrice" required>
</div>

</div>

<div style="margin-top:15px">
<input type="hidden" name="description" id="description"></div>

<!-- SMART PRICE BUTTON -->
<button type="button" class="secondary" id="marketBtn">
ü§ñ Get Smart Market Price
</button>

<!-- MARKET PRICE RESULT -->
<div class="price-box" id="priceBox">
<p>üìâ Low Price: ‚Çπ <span id="low"></span></p>
<p>‚úÖ Fair Price: ‚Çπ <span id="fair"></span></p>
<p>üìà High Price: ‚Çπ <span id="high"></span></p>
</div>

<div class="guarantee-box">
‚úÖ <b>48 Hours Guaranteed Sell Terms:</b><br>
‚Ä¢ Price must be within market <b>Fair Range</b><br>
‚Ä¢ RC & documents mandatory<br>
‚Ä¢ Verified Mumbai dealers only
</div>

<button type="submit" id="submitBtn">
Apply 48H Guaranteed Sell
</button>

<p id="message"></p>

</form>
</div>

<script>
const form = document.getElementById("sell48Form");
const msg = document.getElementById("message");
const btn = document.getElementById("submitBtn");
const marketBtn = document.getElementById("marketBtn");

// ================= MARKET PRICE =================
marketBtn.addEventListener("click", async () => {
  const fd = new FormData(form);
  const params = new URLSearchParams(fd).toString();

  try{
    const res = await fetch(
      "https://cabii-carsandbikesinindia.onrender.com/api/market-rate/check?" + params,
      { credentials:"include" }
    );
    const data = await res.json();

    if(!res.ok){
      alert(data.message || "Market data not available");
      return;
    }

    document.getElementById("priceBox").style.display="block";
    document.getElementById("low").innerText = data.low;
    document.getElementById("fair").innerText = data.fair;
    document.getElementById("high").innerText = data.high;

    // auto fill fair price
    form.expectedPrice.value = data.fair;

  }catch{
    alert("Server error while checking market price");
  }
});

// ================= SUBMIT 48H =================
form.addEventListener("submit", async e=>{
  e.preventDefault();
  msg.textContent="";
  btn.disabled=true;
  btn.textContent="Checking Guarantee Eligibility...";

  const data = Object.fromEntries(new FormData(form));

  try{
    const res = await fetch(
      "https://cabii-carsandbikesinindia.onrender.com/api/sell48/check",
      {
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        credentials:"include",
        body:JSON.stringify(data)
      }
    );

    const r = await res.json();

    if(res.ok){
      msg.className="success";
      msg.textContent="‚úÖ Approved! Dealers will contact you within 48 hours.";
      form.reset();
      document.getElementById("priceBox").style.display="none";
    }else{
      msg.className="error";
      msg.textContent="‚ùå " + (r.message || "Not eligible for guarantee");
    }

  }catch{
    msg.className="error";
    msg.textContent="‚ùå Server error";
  }finally{
    btn.disabled=false;
    btn.textContent="Apply 48H Guaranteed Sell";
  }
});
</script>
<script>
function generateAutoDescription() {
  const brand = document.getElementById("brand")?.value || "";
  const model = document.getElementById("model")?.value || "";
  const year  = document.getElementById("manufacturerYear")?.value || "";
  const km    = document.getElementById("Km")?.value || "";
  const fuel  = document.getElementById("fuel")?.value || "";
  const trans = document.getElementById("transmission")?.value || "";
  const price = document.getElementById("price")?.value || "";

  return `üöó ${brand} ${model} (${year})

‚úî Well maintained vehicle in excellent condition  
‚úî ${km} km driven  
‚úî Fuel type: ${fuel}  
‚úî Transmission: ${trans}  
‚úî Clean RC & verified documents  
‚úî Non-accidental & genuine owner listing  

üí∞ Expected price: ‚Çπ${price}  
üìç Available for immediate inspection  

üîí Verified seller | 48-hour guaranteed deal eligible`;
}
</script>
</body>
</html>